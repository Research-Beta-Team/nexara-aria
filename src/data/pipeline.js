// ─────────────────────────────────────────────
//  Pipeline Manager — mock data
// ─────────────────────────────────────────────

export const PIPELINE_STAGES = [
  'IQL',
  'MQL',
  'SQL',
  'Demo Booked',
  'Proposal Sent',
  'Negotiation',
  'Closed Won',
  'Closed Lost',
];

function tp(type, date, outcome, person) {
  return { type, date, outcome, person };
}

export const DEALS = [
  {
    id: 'd1',
    company: 'TechCorp Global',
    contact: 'James Wu',
    title: 'VP Sales',
    value: 78000,
    stage: 'Negotiation',
    probability: 75,
    daysInStage: 5,
    lastActivity: '2 days ago',
    owner: 'Jordan',
    health: 'healthy',
    nextAction: 'Send revised terms by EOW',
    source: 'Inbound',
    notes: 'Legal reviewing paper. Champion pushing for close.',
    aiRiskFlags: [],
    riskScore: 22,
    riskFactors: ['Deal velocity on track', 'Champion engaged'],
    recommendedActions: ['Send revised terms', 'Schedule legal sync'],
    ariaNextAction: 'Send the revised terms doc and offer a 15-min call with legal if needed.',
    touchpoints: [
      tp('Call', '2025-02-28', 'Terms discussed', 'Jordan'),
      tp('Email', '2025-02-27', 'Proposal sent', 'Jordan'),
      tp('Meeting', '2025-02-25', 'Demo completed', 'Jordan'),
      tp('Call', '2025-02-20', 'Discovery', 'Jordan'),
      tp('Email', '2025-02-18', 'Intro', 'Jordan'),
    ],
  },
  {
    id: 'd2',
    company: 'MedScale Solutions',
    contact: 'Dr. Lisa Wong',
    title: 'Head of Clinical Ops',
    value: 72000,
    stage: 'Proposal Sent',
    probability: 60,
    daysInStage: 12,
    lastActivity: '5 days ago',
    owner: 'Alex',
    health: 'at_risk',
    nextAction: 'Follow up on proposal',
    source: 'ABM',
    notes: 'Proposal opened but no reply yet.',
    aiRiskFlags: ['Proposal opened but not responded to in 5 days'],
    riskScore: 58,
    riskFactors: ['No response to proposal', 'Days in stage above average'],
    recommendedActions: ['Send short follow-up email', 'Offer exec briefing'],
    ariaNextAction: 'Send a one-line follow-up and offer a 15-min exec call to answer questions.',
    touchpoints: [
      tp('Email', '2025-02-24', 'Proposal sent', 'Alex'),
      tp('Call', '2025-02-22', 'Pricing alignment', 'Alex'),
      tp('Meeting', '2025-02-18', 'Demo', 'Alex'),
      tp('Email', '2025-02-15', 'Proposal requested', 'Alex'),
      tp('Call', '2025-02-12', 'Discovery', 'Alex'),
    ],
  },
  {
    id: 'd3',
    company: 'FinServe Inc',
    contact: 'Rachel Kim',
    title: 'SVP Operations',
    value: 58000,
    stage: 'SQL',
    probability: 40,
    daysInStage: 18,
    lastActivity: '12 days ago',
    owner: 'Jordan',
    health: 'stalled',
    nextAction: 'Re-engage with peer story',
    source: 'Campaign',
    notes: 'Went quiet after steering committee.',
    aiRiskFlags: ['No activity in 12 days'],
    riskScore: 72,
    riskFactors: ['No touch in 12 days', 'Champion may have competing priorities'],
    recommendedActions: ['Send peer case study', 'Request reconnect call'],
    ariaNextAction: 'Send one relevant peer case study and ask for best time to reconnect.',
    touchpoints: [
      tp('Meeting', '2025-02-17', 'Steering committee', 'Jordan'),
      tp('Call', '2025-02-14', 'Follow-up', 'Jordan'),
      tp('Email', '2025-02-10', 'Case study', 'Jordan'),
      tp('Call', '2025-02-07', 'Discovery', 'Jordan'),
      tp('Email', '2025-02-05', 'Intro', 'Jordan'),
    ],
  },
  {
    id: 'd4',
    company: 'CloudNine Software',
    contact: 'Chris Adams',
    title: 'Head of Sales',
    value: 18500,
    stage: 'Closed Won',
    probability: 100,
    daysInStage: 0,
    lastActivity: '1 day ago',
    owner: 'Sam',
    health: 'healthy',
    nextAction: 'Kick off onboarding',
    source: 'Inbound',
    notes: 'Signed. Start date next week.',
    aiRiskFlags: [],
    riskScore: 5,
    riskFactors: [],
    recommendedActions: [],
    ariaNextAction: 'Schedule kickoff and send welcome pack.',
    touchpoints: [
      tp('Email', '2025-03-01', 'Contract signed', 'Sam'),
      tp('Call', '2025-02-28', 'Final terms', 'Sam'),
      tp('Meeting', '2025-02-26', 'Legal sign-off', 'Sam'),
    ],
  },
  {
    id: 'd5',
    company: 'RetailMax',
    contact: 'Patricia Moore',
    title: 'VP Merchandising',
    value: 30000,
    stage: 'Demo Booked',
    probability: 50,
    daysInStage: 3,
    lastActivity: '1 day ago',
    owner: 'Alex',
    health: 'healthy',
    nextAction: 'Prepare for demo Thu',
    source: 'Partner',
    notes: 'Demo Thu 2pm. Technical buyer joining.',
    aiRiskFlags: [],
    riskScore: 18,
    riskFactors: [],
    recommendedActions: ['Confirm demo agenda', 'Send pre-read'],
    ariaNextAction: 'Send calendar hold and a 1-pager so they come prepared.',
    touchpoints: [
      tp('Call', '2025-03-01', 'Demo booked', 'Alex'),
      tp('Email', '2025-02-28', 'Availability', 'Alex'),
      tp('Call', '2025-02-26', 'Discovery', 'Alex'),
    ],
  },
  {
    id: 'd6',
    company: 'EduTech Partners',
    contact: 'Nancy Foster',
    title: 'Director of Programs',
    value: 12500,
    stage: 'Closed Lost',
    probability: 0,
    daysInStage: 0,
    lastActivity: '8 days ago',
    owner: 'Sam',
    health: 'stalled',
    nextAction: '—',
    source: 'Inbound',
    notes: 'Lost to budget freeze. Re-engage in Q3.',
    aiRiskFlags: [],
    riskScore: 100,
    riskFactors: ['Deal closed lost'],
    recommendedActions: ['Log loss reason', 'Set Q3 follow-up'],
    ariaNextAction: 'Set a reminder for Q3 to re-engage when budget opens.',
    touchpoints: [
      tp('Call', '2025-02-22', 'Budget freeze', 'Sam'),
      tp('Email', '2025-02-20', 'Proposal', 'Sam'),
    ],
  },
  {
    id: 'd7',
    company: 'LogiFlow Systems',
    contact: 'Susan Wright',
    title: 'VP Operations',
    value: 36000,
    stage: 'Proposal Sent',
    probability: 65,
    daysInStage: 6,
    lastActivity: '2 days ago',
    owner: 'Jordan',
    health: 'healthy',
    nextAction: 'Follow up with COO',
    source: 'ABM',
    notes: 'COO review next week.',
    aiRiskFlags: [],
    riskScore: 25,
    riskFactors: [],
    recommendedActions: ['Send one-pager to COO', 'Request 30 min'],
    ariaNextAction: 'Send one-pager and request 30 min on COO calendar.',
    touchpoints: [
      tp('Email', '2025-02-27', 'Proposal sent', 'Jordan'),
      tp('Call', '2025-02-26', 'Intro with COO', 'Jordan'),
      tp('Meeting', '2025-02-24', 'Demo', 'Jordan'),
    ],
  },
  {
    id: 'd8',
    company: 'StartupLabs',
    contact: 'Jake Miller',
    title: 'Founder & CEO',
    value: 8000,
    stage: 'MQL',
    probability: 25,
    daysInStage: 4,
    lastActivity: '3 days ago',
    owner: 'Sam',
    health: 'healthy',
    nextAction: 'Send demo recording',
    source: 'Website',
    notes: 'Founder-led. Fast mover.',
    aiRiskFlags: [],
    riskScore: 15,
    riskFactors: [],
    recommendedActions: [],
    ariaNextAction: 'Send demo recording and simple pricing next step.',
    touchpoints: [
      tp('Email', '2025-02-26', 'Demo link', 'Sam'),
      tp('Call', '2025-02-25', 'Discovery', 'Sam'),
    ],
  },
  {
    id: 'd9',
    company: 'GreenEnergy Co',
    contact: 'Lisa Chen',
    title: 'Sustainability Lead',
    value: 12000,
    stage: 'SQL',
    probability: 35,
    daysInStage: 14,
    lastActivity: '7 days ago',
    owner: 'Alex',
    health: 'at_risk',
    nextAction: 'Send sustainability content',
    source: 'Campaign',
    notes: 'Champion went quiet.',
    aiRiskFlags: ['No activity in 12 days'],
    riskScore: 55,
    riskFactors: ['Champion quiet', 'Above avg days in stage'],
    recommendedActions: ['Send one piece of content', 'Ask for reconnect'],
    ariaNextAction: 'Send one relevant sustainability asset and ask for best time to reconnect.',
    touchpoints: [
      tp('Email', '2025-02-23', 'Proposal', 'Alex'),
      tp('Call', '2025-02-20', 'Intro', 'Alex'),
    ],
  },
  {
    id: 'd10',
    company: 'MediaHouse',
    contact: 'David Brown',
    title: 'Head of Ops',
    value: 5800,
    stage: 'Closed Won',
    probability: 100,
    daysInStage: 0,
    lastActivity: '2 days ago',
    owner: 'Jordan',
    health: 'healthy',
    nextAction: 'Onboarding',
    source: 'Inbound',
    notes: 'Closed. Contract signed.',
    aiRiskFlags: [],
    riskScore: 0,
    riskFactors: [],
    recommendedActions: [],
    ariaNextAction: 'Complete onboarding checklist.',
    touchpoints: [
      tp('Email', '2025-02-28', 'Contract', 'Jordan'),
      tp('Call', '2025-02-27', 'Verbal commit', 'Jordan'),
    ],
  },
  {
    id: 'd11',
    company: 'BuildRight Construction',
    contact: 'Mike Torres',
    title: 'VP Operations',
    value: 8800,
    stage: 'Closed Lost',
    probability: 0,
    daysInStage: 0,
    lastActivity: '14 days ago',
    owner: 'Sam',
    health: 'stalled',
    nextAction: '—',
    source: 'Partner',
    notes: 'Went with incumbent. Price.',
    aiRiskFlags: [],
    riskScore: 100,
    riskFactors: ['Deal closed lost'],
    recommendedActions: ['Log loss reason'],
    ariaNextAction: 'Document loss reason and set 6-month nurture.',
    touchpoints: [
      tp('Call', '2025-02-16', 'Lost to incumbent', 'Sam'),
      tp('Email', '2025-02-14', 'Proposal', 'Sam'),
    ],
  },
  {
    id: 'd12',
    company: 'DataVault Security',
    contact: 'Anna Kumar',
    title: 'CISO',
    value: 10000,
    stage: 'Demo Booked',
    probability: 45,
    daysInStage: 2,
    lastActivity: '1 day ago',
    owner: 'Alex',
    health: 'healthy',
    nextAction: 'Send SOC 2 doc',
    source: 'Inbound',
    notes: 'Security review requested.',
    aiRiskFlags: [],
    riskScore: 20,
    riskFactors: [],
    recommendedActions: ['Send SOC 2', 'Book technical call'],
    ariaNextAction: 'Send SOC 2 one-pager and book technical call.',
    touchpoints: [
      tp('Email', '2025-03-01', 'Security questionnaire', 'Alex'),
      tp('Call', '2025-02-28', 'Intro', 'Alex'),
    ],
  },
  {
    id: 'd13',
    company: 'Acme Manufacturing',
    contact: 'Sarah Lee',
    title: 'CFO',
    value: 118000,
    stage: 'IQL',
    probability: 10,
    daysInStage: 6,
    lastActivity: '4 days ago',
    owner: 'Jordan',
    health: 'healthy',
    nextAction: 'Nurture sequence',
    source: 'Campaign',
    notes: 'Downloaded whitepaper. In sequence.',
    aiRiskFlags: [],
    riskScore: 30,
    riskFactors: ['Early stage'],
    recommendedActions: [],
    ariaNextAction: 'Continue nurture; trigger on next engagement.',
    touchpoints: [
      tp('Email', '2025-02-26', 'Whitepaper', 'Jordan'),
      tp('Email', '2025-02-24', 'Touch 1', 'Jordan'),
    ],
  },
  {
    id: 'd14',
    company: 'ScaleUp Ventures',
    contact: 'Tom Bradley',
    title: 'CTO',
    value: 52000,
    stage: 'Negotiation',
    probability: 70,
    daysInStage: 8,
    lastActivity: '3 days ago',
    owner: 'Sam',
    health: 'at_risk',
    nextAction: 'Address competitor concern',
    source: 'Referral',
    notes: 'Competitor mentioned on last call.',
    aiRiskFlags: ['Competitor mentioned in last call'],
    riskScore: 48,
    riskFactors: ['Competitor in deal', 'Need differentiation'],
    recommendedActions: ['Send competitive one-pager', 'Offer battle card call'],
    ariaNextAction: 'Send competitive differentiation doc and offer a battle card call.',
    touchpoints: [
      tp('Call', '2025-02-27', 'Competitor mentioned', 'Sam'),
      tp('Meeting', '2025-02-24', 'Technical review', 'Sam'),
      tp('Email', '2025-02-22', 'Proposal', 'Sam'),
    ],
  },
  {
    id: 'd15',
    company: 'HealthFirst Group',
    contact: 'Emma Davis',
    title: 'General Counsel',
    value: 78000,
    stage: 'SQL',
    probability: 45,
    daysInStage: 9,
    lastActivity: '6 days ago',
    owner: 'Jordan',
    health: 'healthy',
    nextAction: 'Send compliance doc',
    source: 'ABM',
    notes: 'Legal involved early. Good sign.',
    aiRiskFlags: [],
    riskScore: 28,
    riskFactors: [],
    recommendedActions: ['Send compliance overview'],
    ariaNextAction: 'Send compliance overview and offer legal sync.',
    touchpoints: [
      tp('Call', '2025-02-24', 'Legal intro', 'Jordan'),
      tp('Meeting', '2025-02-21', 'Demo', 'Jordan'),
      tp('Email', '2025-02-19', 'Follow-up', 'Jordan'),
    ],
  },
  {
    id: 'd16',
    company: 'Nexus Finance',
    contact: 'David Park',
    title: 'VP Finance',
    value: 66000,
    stage: 'Proposal Sent',
    probability: 55,
    daysInStage: 15,
    lastActivity: '10 days ago',
    owner: 'Alex',
    health: 'at_risk',
    nextAction: 'Re-engage champion',
    source: 'Campaign',
    notes: 'Champion changed jobs. New contact TBD.',
    aiRiskFlags: ['Champion contact changed jobs'],
    riskScore: 68,
    riskFactors: ['Champion left', 'Stakeholder change'],
    recommendedActions: ['Identify new champion', 'Re-intro to new VP'],
    ariaNextAction: 'Find new champion and request intro to new VP Finance.',
    touchpoints: [
      tp('Email', '2025-02-20', 'Proposal', 'Alex'),
      tp('Call', '2025-02-18', 'Champion left', 'Alex'),
      tp('Meeting', '2025-02-15', 'Demo', 'Alex'),
    ],
  },
  {
    id: 'd17',
    company: 'Global Logistics Co',
    contact: 'Mark Johnson',
    title: 'COO',
    value: 101000,
    stage: 'Demo Booked',
    probability: 50,
    daysInStage: 1,
    lastActivity: 'Today',
    owner: 'Jordan',
    health: 'healthy',
    nextAction: 'Demo prep',
    source: 'ABM',
    notes: 'Demo Friday. Multi-stakeholder.',
    aiRiskFlags: [],
    riskScore: 12,
    riskFactors: [],
    recommendedActions: ['Confirm attendees', 'Send agenda'],
    ariaNextAction: 'Confirm attendees and send one-pager so COO comes prepared.',
    touchpoints: [
      tp('Call', '2025-03-01', 'Demo booked', 'Jordan'),
      tp('Email', '2025-02-28', 'Availability', 'Jordan'),
    ],
  },
  {
    id: 'd18',
    company: 'Summit SaaS',
    contact: 'Rachel Green',
    title: 'Head of Product',
    value: 29500,
    stage: 'Closed Won',
    probability: 100,
    daysInStage: 0,
    lastActivity: '3 days ago',
    owner: 'Sam',
    health: 'healthy',
    nextAction: 'Kickoff',
    source: 'Inbound',
    notes: 'Signed. Implementation next week.',
    aiRiskFlags: [],
    riskScore: 0,
    riskFactors: [],
    recommendedActions: [],
    ariaNextAction: 'Schedule implementation kickoff.',
    touchpoints: [
      tp('Email', '2025-02-27', 'Contract signed', 'Sam'),
      tp('Call', '2025-02-26', 'Final terms', 'Sam'),
    ],
  },
];

// Derived stats (can be computed in page or here)
export function getPipelineStats(deals = DEALS) {
  const openDeals = deals.filter((d) => d.stage !== 'Closed Won' && d.stage !== 'Closed Lost');
  const totalPipeline = openDeals.reduce((s, d) => s + d.value, 0);
  const weightedPipeline = openDeals.reduce((s, d) => s + (d.value * (d.probability || 0)) / 100, 0);
  const atRisk = deals.filter((d) => d.health === 'at_risk').length;
  const avgDealSize = openDeals.length ? Math.round(totalPipeline / openDeals.length) : 0;
  const won = deals.filter((d) => d.stage === 'Closed Won').length;
  const lost = deals.filter((d) => d.stage === 'Closed Lost').length;
  const winRate = won + lost > 0 ? Math.round((won / (won + lost)) * 100) : 0;
  return {
    totalPipeline,
    weightedPipeline,
    dealsAtRisk: atRisk,
    avgDealSize,
    winRate,
  };
}
